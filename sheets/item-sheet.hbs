<form class="{{cssClass}}" autocomplete="off">
  <header class="sheet-header" style="display:flex; align-items:center; gap:10px;">
    <img src="{{item.img}}" data-edit="img" title="{{item.name}}" style="flex:0 0 64px; height:64px; border:1px solid #333;"/>
    <div class="header-fields" style="flex:1;">
        <h1><input name="name" type="text" value="{{item.name}}" placeholder="Название"/></h1>
        <div class="grid grid-2col">
            <div class="form-group">
                <label>Вес</label>
                <input type="number" name="system.weight" value="{{system.weight}}" step="0.1"/>
            </div>
            <div class="form-group">
                <label>Кол-во</label>
                <input type="number" name="system.quantity" value="{{system.quantity}}"/>
            </div>
        </div>
    </div>
  </header>

  <nav class="sheet-tabs tabs" data-group="primary">
    <a class="item" data-tab="details">Параметры</a>
    <a class="item" data-tab="description">Описание</a>
  </nav>

  <section class="sheet-body">
    
    <!-- TAB: DETAILS -->
    <div class="tab details" data-group="primary" data-tab="details">

        <!-- СЕКЦИЯ ПРОЕКТОВ И ПОСТРОЕК -->
        {{#if (or (eq item.type "upgrade") (eq item.type "project"))}}
        <div class="project-settings">
            <h3>Требования Проекта</h3>
            <div class="grid grid-2col">
                <div class="form-group">
                    <label>Время (Часы)</label>
                    <input type="number" name="system.hoursNeeded" value="{{system.hoursNeeded}}"/>
                </div>
                <div class="form-group">
                    <label>Стоимость (Детали)</label>
                    <input type="number" name="system.partsCost" value="{{system.partsCost}}"/>
                </div>
                <div class="form-group">
                    <label>Мин. Людей</label>
                    <input type="number" name="system.minPeople" value="{{system.minPeople}}"/>
                </div>
                <div class="form-group">
                    <label>Навык</label>
                    <select name="system.reqSkill">
                        {{selectOptions skillsList selected=system.reqSkill localize=false}}
                    </select>
                </div>
                <div class="form-group">
                    <label>Мин. Уровень Навыка</label>
                    <input type="number" name="system.reqLevel" value="{{system.reqLevel}}"/>
                </div>
            </div>
            <div class="form-group">
                <label>Текущий прогресс (Часы)</label>
                <input type="number" name="system.progress" value="{{system.progress}}"/>
            </div>
            <div class="form-group">
                <label>Внесено деталей</label>
                <input type="number" name="system.partsPaid" value="{{system.partsPaid}}"/>
            </div>
            <hr>
            <h3>Эффект при завершении (Ежедневный)</h3>
            <div class="grid grid-2col">
                <div class="form-group">
                    <label>Тип Бонуса</label>
                    <select name="system.bonusType">
                        {{selectOptions bonusTypes selected=system.bonusType localize=false}}
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Значение / Кол-во</label>
                    <input type="number" name="system.bonusValue" value="{{system.bonusValue}}"/>
                </div>

                {{#if (eq system.bonusType "medicine")}}
                <div class="form-group" style="grid-column: span 2;">
                    <label>Создаваемый предмет (название)</label>
                    <input type="text" name="system.outputItem" value="{{system.outputItem}}" placeholder="Например: Бинт"/>
                </div>
                {{/if}}

                <div class="form-group flexrow">
                    <label>Завершено?</label>
                    <input type="checkbox" name="system.isCompleted" {{checked system.isCompleted}}/>
                </div>
            </div>
        </div>
        {{/if}}
        
        <!-- === СЕКЦИЯ ОРУЖИЯ === -->
        {{#if (eq item.type "weapon")}}
        <div class="weapon-properties">
            <div class="grid grid-3col">
                <!-- Тип и Хват -->
                <div class="form-group">
                    <label>Тип</label>
                    <select name="system.weaponType">
                        {{selectOptions weaponTypes selected=system.weaponType localize=false}}
                    </select>
                </div>
                <div class="form-group">
                    <label>Хват</label>
                    <select name="system.hands">
                        {{selectOptions handsOptions selected=system.hands localize=false}}
                    </select>
                </div>
                <div class="form-group">
                    <label>Урон</label>
                    <select name="system.damageType">
                        {{selectOptions damageTypes selected=system.damageType localize=false}}
                    </select>
                </div>
                
                <!-- Параметры -->
                <div class="form-group">
                    <label>Дальность</label>
                    <input type="number" name="system.range" value="{{system.range}}"/>
                </div>
                <div class="form-group">
                    <label>Шум</label>
                    <input type="number" name="system.noise" value="{{system.noise}}"/>
                </div>
                <div class="form-group">
                    <label>Треб. Силы</label>
                    <input type="number" name="system.strReq" value="{{system.strReq}}"/>
                </div>
                
                <!-- ПАТРОНЫ И МАГАЗИН -->
                <div class="form-group">
                    <label>Патроны (тип)</label>
                    <input type="text" name="system.ammoType" value="{{system.ammoType}}" placeholder="Напр: 9mm"/>
                </div>

                <div class="form-group"><label>Емкость Маг.</label><input type="number" name="system.mag.max" value="{{system.mag.max}}"/></div>
                <div class="form-group"><label>В стволе</label><input type="number" name="system.mag.value" value="{{system.mag.value}}"/></div>
                <div class="form-group"><label>AP Перезаряд.</label><input type="number" name="system.reloadAP" value="{{system.reloadAP}}"/></div>

                <!-- Прочность -->
                <div class="form-group">
                    <label>Прочность</label>
                    <div class="flexrow">
                        <input type="number" name="system.hp.value" value="{{system.hp.value}}" placeholder="Cur"/>
                        <span>/</span>
                        <input type="number" name="system.hp.max" value="{{system.hp.max}}" placeholder="Max"/>
                    </div>
                </div>
            </div>
        </div>
        <hr>
        <!-- Секция Атак -->
        <div class="attacks-section">
            <div class="flexrow" style="align-items:center; margin-bottom:5px;">
                <h3>Варианты Атаки</h3>
                <a class="attack-create" title="Добавить атаку"><i class="fas fa-plus"></i></a>
            </div>
            
            <div class="attacks-table">
                <div class="attack-header flexrow" style="border-bottom:1px solid #777; padding-bottom:2px; margin-bottom:5px; font-weight:bold;">
                    <div style="flex:1.5">Название</div>
                    <div style="flex:0.4; text-align:center;">AP</div>
                    <div style="flex:0.8; text-align:center;">Урон</div>
                    <div style="flex:0.4; text-align:center;">Точн.</div>
                    <div style="flex:1; text-align:center;">Эффект</div>
                    <div style="flex:0.4; text-align:center;">%</div>
                    <div style="flex:0.3"></div>
                </div>
                
                {{#each system.attacks as |attack key|}}
                <div class="attack-row flexrow" style="margin-top: 5px; background: rgba(0,0,0,0.05); padding: 4px; border-radius: 4px; align-items:center;">
                    <div style="flex:1.5"><input type="text" name="system.attacks.{{key}}.name" value="{{attack.name}}" placeholder="Name"/></div>
                    <div style="flex:0.4"><input type="number" name="system.attacks.{{key}}.ap" value="{{attack.ap}}"/></div>
                    <div style="flex:0.8"><input type="text" name="system.attacks.{{key}}.dmg" value="{{attack.dmg}}"/></div>
                    <div style="flex:0.4"><input type="number" name="system.attacks.{{key}}.mod" value="{{attack.mod}}"/></div>
                    
                    <!-- Выбор эффекта -->
                    <div style="flex:1">
                        <select name="system.attacks.{{key}}.effect" style="width:100%; font-size:0.8em;">
                            {{selectOptions ../statusOptions selected=attack.effect localize=false}}
                        </select>
                    </div>
                    <!-- Шанс -->
                    <div style="flex:0.4"><input type="number" name="system.attacks.{{key}}.chance" value="{{attack.chance}}" placeholder="%"/></div>

                    <div style="flex:0.3; text-align:center;"><a class="attack-delete" data-key="{{key}}"><i class="fas fa-trash"></i></a></div>
                </div>
                {{/each}}
            </div>
        </div>
        {{/if}}

        <!-- ПАТРОНЫ -->
        {{#if (eq item.type "ammo")}}
        <div class="ammo-properties">
            <div class="form-group">
                <label>Калибр</label>
                <input type="text" name="system.calibre" value="{{system.calibre}}" placeholder="Напр: 9mm"/>
            </div>
        </div>
        {{/if}}

        <!-- БРОНЯ -->
        {{#if (eq item.type "armor")}}
        <div class="armor-properties">
            <div class="form-group">
                <label>AC</label>
                <input type="number" name="system.ac" value="{{system.ac}}"/>
            </div>
            <div class="dr-table">
                <h3>Сопротивление (%)</h3>
                <div class="form-group flexrow"><label>Дробящий</label><input type="number" name="system.dr.blunt" value="{{system.dr.blunt}}"/></div>
                <div class="form-group flexrow"><label>Режущий</label><input type="number" name="system.dr.slashing" value="{{system.dr.slashing}}"/></div>
                <div class="form-group flexrow"><label>Колющий</label><input type="number" name="system.dr.piercing" value="{{system.dr.piercing}}"/></div>
                <div class="form-group flexrow"><label>Пулевой</label><input type="number" name="system.dr.ballistic" value="{{system.dr.ballistic}}"/></div>
                <div class="form-group flexrow"><label>Огонь</label><input type="number" name="system.dr.fire" value="{{system.dr.fire}}"/></div>
            </div>
            <div class="coverage-table">
                <h3>Зоны</h3>
                <div class="form-group flexrow"><label>Торс</label><input type="checkbox" name="system.coverage.torso" {{checked system.coverage.torso}}/></div>
                <div class="form-group flexrow"><label>Голова</label><input type="checkbox" name="system.coverage.head" {{checked system.coverage.head}}/></div>
            </div>
        </div>
        {{/if}}

        {{#if (ne item.type "weapon")}}
        {{#if (ne item.type "armor")}}
            <div class="form-group">
                <label>Категория</label>
                <select name="system.category">
                    {{selectOptions categoryOptions selected=system.category localize=false}}
                </select>
            </div>
        {{/if}}
        {{/if}}

    </div>

    <!-- TAB: DESCRIPTION -->
    <div class="tab description" data-group="primary" data-tab="description">
        <textarea name="system.description">{{system.description}}</textarea>
    </div>
  </section>
</form>